from aiogram import Bot
from aiogram.types import (
    ReplyKeyboardMarkup,
    KeyboardButton,
    InlineKeyboardMarkup,
    InlineKeyboardButton,
    BotCommand,
)

from bot.config import SubscriptionsStore as Store


def get_main_menu() -> ReplyKeyboardMarkup:
    buttons = [
        [KeyboardButton(text="/stats")],
        [KeyboardButton(text="/help")],
        [KeyboardButton(text="/subscribe")],
        [KeyboardButton(text="/set_goal")],
    ]
    return ReplyKeyboardMarkup(
        keyboard=buttons,
        resize_keyboard=True,
        input_field_placeholder="–û—Ç–ø—Ä–∞–≤—å —Ñ–æ—Ç–æ –µ–¥—ã, —Ç–µ–∫—Å—Ç –∏–ª–∏ –∞—É–¥–∏–æ..."
    )


def get_subscriptions_menu() -> InlineKeyboardMarkup:
    inline_keyboard : list[list[InlineKeyboardButton]] = []

    inline_keyboard.append([
        InlineKeyboardButton(
            text="üìÑ –û–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –æ—Ñ–µ—Ä—Ç–æ–π",
            callback_data="show_offer"
        )
    ])

    for subscription in Store:
        price : float = subscription.price
        title : str = subscription.title
        duration : int = subscription.duration_month
        button_text : str = f"{duration} –º–µ—Å: ‚Äì {price} —Ä—É–±."
        inline_keyboard.append([
            InlineKeyboardButton(
                text=button_text,
                callback_data=f"sub_duration:{duration}"
            )
        ])


    return InlineKeyboardMarkup(
        inline_keyboard=inline_keyboard
    )


def get_subscription_confirmation_menu(url : str, payment_id : str) -> InlineKeyboardMarkup:
    keyboard = InlineKeyboardMarkup(inline_keyboard=[
        [
            InlineKeyboardButton(text="üí≥ –û–ø–ª–∞—Ç–∏—Ç—å", url=url),
            InlineKeyboardButton(text="üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å", callback_data=f"subscription_payment_id:{payment_id}")
        ]
    ])

    return keyboard



async def set_bot_commands(bot: Bot):
    commands = [
        BotCommand(command="start", description="–ù–∞—á–∞—Ç—å"),
        BotCommand(command="subscribe", description="–¢–∞—Ä–∏—Ñ—ã"),
        BotCommand(command="help", description="–ü–æ–º–æ—â—å"),

        BotCommand(command="stats", description="–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"),
        BotCommand(command="set_goal", description="–¶–µ–ª—å –ø–æ –∫–∞–ª–æ—Ä–∏—è–º"),
    ]
    await bot.set_my_commands(commands)
