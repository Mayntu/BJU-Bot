import os

from dotenv import load_dotenv
from enum import Enum

load_dotenv()

# from pydantic import BaseSettings

# class Settings(BaseSettings):
#     BOT_TOKEN: str
#     DATABASE_URL: str
#     OPENAI_KEY: str

#     class Config:
#         env_file = ".env"

# settings : Settings = Settings()

# TODO: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å pydantic –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫


# ------------------- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è ------------------- #

BOT_TOKEN : str = os.getenv("BOT_TOKEN")
OPENAI_KEY : str = os.getenv("OPENAI_KEY")
IMGBB_API_KEY : str = os.getenv("IMGBB_API_KEY")
DB_URL : str = os.getenv("DATABASE_URL")
REDIS_HOST : str = os.getenv("REDIS_HOST", "redis")
REDIS_PORT : int = int(os.getenv("REDIS_PORT", 6379))
REDIS_URL = os.getenv("REDIS_URL", "redis://redis:6379/0")
YOOKASSA_SHOP_ID : str = os.getenv("YOOKAASSA_SHOP_ID")
YOOKASSA_SECRET_KEY : str = os.getenv("YOOKASSA_SECRET_KEY")

MAX_IMAGE_TOKENS : str = int(os.getenv("MAX_IMAGE_TOKENS", 1000))
MAX_DESCRIPTION_TOKENS : int = int(os.getenv("MAX_DESCRIPTION_TOKENS", 300))
FREE_MEAL_COUNT : int = int(os.getenv("FREE_MEAL_COUNT", 5))
OFERTA_FILE_ID : str = os.getenv("OFERTA_FILE_ID")


# ------------------- –í–∞—Ä–∏–∞–Ω—Ç—ã –ø–æ–¥–ø–∏—Å–æ–∫ ------------------- #

class SubscriptionsStore(Enum):
    """
    Enum –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–∞—Ä–∏—Ñ–æ–≤ –ø–æ–¥–ø–∏—Å–æ–∫.
    –ö–∞–∂–¥—ã–π —Ç–∞—Ä–∏—Ñ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ, —Ü–µ–Ω—É –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ –º–µ—Å—è—Ü–∞—Ö.
    """
    BASIC_ONE_MONTH = ("basic", 270, 1)
    BASIC_THREE_MONTH = ("basic", 770, 3)
    BASIC_SIX_MONTH = ("basic", 1490, 6)

    @staticmethod
    def get_by_title(title: str) -> "SubscriptionsStore":
        """
        –ü–æ–ª—É—á–∞–µ—Ç –æ–±—ä–µ–∫—Ç –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é.
        
        :param title: –ù–∞–∑–≤–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏
        :return: –û–±—ä–µ–∫—Ç SubscriptionsStore –∏–ª–∏ None, –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
        """
        for subscription in SubscriptionsStore:
            if subscription.title == title:
                return subscription
        
        return None
    
    @staticmethod
    def get_by_duration(duration : int) -> "SubscriptionsStore":
        """
        –ü–æ–ª—É—á–∞–µ—Ç –æ–±—ä–µ–∫—Ç –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.
        
        :param duration: –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–¥–ø–∏—Å–∫–∏ (int)
        :return: –û–±—ä–µ–∫—Ç SubscriptionsStore –∏–ª–∏ None, –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
        """
        for subscription in SubscriptionsStore:
            if str(subscription.duration_month) == str(duration):
                return subscription
        
        return None

    def __init__(self, title : str, price : float, duration_month : int) -> None:
        self.title = title
        self.price = price
        self.duration_month = duration_month
    
    # @staticmethod
    # def find_by_duration(duration_month : int) -> "ScriptStore":
    #     for script in SubscriptionsStore:
    #         if duration_month == script.duration_month:
    #             return script
        
    #     return None


class YOOKASSA_PAYMENT_STATUS(Enum):
    """
    Enum –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ –ø–ª–∞—Ç–µ–∂–µ–π –≤ –ÆKassa.
    """
    PENDING = "pending"
    SUCCEEDED = "succeeded"
    CANCELED = "canceled"

    @staticmethod
    def is_successful(status: str) -> bool:
        """
        –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å—Ç–∞—Ç—É—Å —É—Å–ø–µ—à–Ω—ã–º.
        
        :param status: –°—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞
        :return: True, –µ—Å–ª–∏ —Å—Ç–∞—Ç—É—Å —É—Å–ø–µ—à–Ω—ã–π, –∏–Ω–∞—á–µ False
        """
        return status in [YOOKASSA_PAYMENT_STATUS.SUCCEEDED.value]


# ------------------- –ö–æ–Ω—Ñ–∏–≥ Tortoise ORM ------------------- #

TORTOISE_ORM = {
    "connections": {
        "default": DB_URL
    },
    "apps": {
        "models": {
            "models": ["db.models", "aerich.models"],
            "default_connection": "default",
        },
    },
    "use_tz": True,
    "timezone": "UTC",
}


# ------------------- –°–æ–æ–±—â–µ–Ω–∏—è –±–æ—Ç–∞ ------------------- #

BOT_MEAL_REPORT : str = """{meal_name}  
–í–µ—Å –±–ª—é–¥–∞: {meal_weight} –≥—Ä.  
–ü—Ä–∏–º–µ—Ä–Ω–∞—è –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç—å: {meal_ccal} –∫–∫–∞–ª.  

–ë–ñ–£–ö:  
–ë–µ–ª–∫–∏: {meal_protein} –≥—Ä.  
–ñ–∏—Ä—ã: {meal_fat} –≥—Ä.  
–£–≥–ª–µ–≤–æ–¥—ã: {meal_carb} –≥—Ä.  
–ö–ª–µ—Ç—á–∞—Ç–∫–∞: {meal_fiber} –≥—Ä.  

–°–æ—Å—Ç–∞–≤:
"""

BOT_DAILY_MEAL_REPORT : str = """üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ —Å–µ–≥–æ–¥–Ω—è:
–ö–∞–ª–æ—Ä–∏–∏: {total_calories} –∫–∫–∞–ª
–ë–µ–ª–∫–∏: {total_proteins} –≥ ({proteins_pct}%)
–ñ–∏—Ä—ã: {total_fats} –≥ ({fats_pct}%)
–£–≥–ª–µ–≤–æ–¥—ã: {total_carbs} –≥ ({carbs_pct}%)
–ö–ª–µ—Ç—á–∞—Ç–∫–∞: {total_fiber} –≥\n
üçΩ –ü—Ä–∏–µ–º—ã –ø–∏—â–∏:
"""

BUY_TEXT : str = """üõí –í—ã –≤—ã–±—Ä–∞–ª–∏ –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ {duration} –º–µ—Å.
üí≥ –ù–∞–∂–º–∏—Ç–µ "–û–ø–ª–∞—Ç–∏—Ç—å", –∞ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞ ‚Äî "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å".
‚ö†Ô∏è –ü—Ä–µ–∂–¥–µ —á–µ–º –æ–ø–ª–∞—á–∏–≤–∞—Ç—å, –æ–∑–Ω–∞–∫–æ–º—å—Ç–µ—Å—å —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ–º.
"""

HELLO_TEXT : str = """
<b>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –¢–∞—Ä–µ–ª–∫–∞ ‚Äî —Ç–≤–æ–π –ò–ò-–ø–æ–º–æ—à–Ω–∏–∫ –ø–æ –ø–æ–¥—Å—á–µ—Ç—É –∫–∞–ª–æ—Ä–∏–π –≤ Telegram!</b>

–ü—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤—å —Ñ–æ—Ç–æ –µ–¥—ã, –≥–æ–ª–æ—Å–æ–≤–æ–µ –∏–ª–∏ —Ç–µ–∫—Å—Ç ‚Äî –∏ —è –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ —Ä–∞–∑–±–µ—Ä—É —Å–æ—Å—Ç–∞–≤, –∫–∞–ª–æ—Ä–∏–∏ –∏ –ë–ñ–£. 
<b>–ß—Ç–æ —è —É–º–µ—é:</b>
‚úÖ¬†<b>–ê–Ω–∞–ª–∏–∑ —Ñ–æ—Ç–æ –µ–¥—ã</b>¬†‚Äî –ò–ò —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç –¥–∞–∂–µ —Å–ª–æ–∂–Ω—ã–µ –±–ª—é–¥–∞.
‚úÖ¬†<b>–ì–æ–ª–æ—Å–æ–≤–æ–π –∏ —Ç–µ–∫—Å—Ç–æ–≤—ã–π –≤–≤–æ–¥</b>¬†‚Äî –≥–æ–≤–æ—Ä–∏ –∏–ª–∏ –ø–∏—à–∏, —á—Ç–æ —Å—ä–µ–ª, –∞ —è –≤—Å—ë —É—á—Ç—É.
‚úÖ¬†<b>–†–∞—Å—á–µ—Ç –ö–ë–ñ–£ –∏ –ö</b>¬†‚Äî –∫–∞–ª–æ—Ä–∏–∏, –±–µ–ª–∫–∏, –∂–∏—Ä—ã, —É–≥–ª–µ–≤–æ–¥—ã –∏ –∫–ª–µ—Ç—á–∞—Ç–∫–∞ —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é –¥–æ 90%.
‚úÖ¬†<b>–£–º–Ω—ã–π –¥–Ω–µ–≤–Ω–∏–∫</b>¬†‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –¥–µ–Ω—å.
–ß—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å, –ø—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤—å –º–Ω–µ —Ñ–æ—Ç–æ —Å–≤–æ–µ–≥–æ –∑–∞–≤—Ç—Ä–∞–∫–∞, –æ–±–µ–¥–∞ –∏–ª–∏ —É–∂–∏–Ω–∞ ‚Äî –∏ —è –≤—Å—ë –ø–æ—Å—á–∏—Ç–∞—é!
"""

HELP_TEXT : str = """
<b>–ü–æ–º–æ—â—å –ø–æ –±–æ—Ç—É Tarelka</b>
<b>–¢–∞—Ä–µ–ª–∫–∞</b> ‚Äì —ç—Ç–æ –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –µ–¥—É –ø–æ —Ñ–æ—Ç–æ, –≥–æ–ª–æ—Å—É –∏–ª–∏ —Ç–µ–∫—Å—Ç—É. 
<b>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:</b>
‚Ä¢ –û—Ç–ø—Ä–∞–≤—å—Ç–µ¬†—Ñ–æ—Ç–æ –µ–¥—ã¬†–≤ —á–∞—Ç ‚Äì –±–æ—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç –±–ª—é–¥–æ –∏ –ø–æ—Å—á–∏—Ç–∞–µ—Ç –ö–ë–ñ–£.
‚Ä¢ –ù–∞–ø–∏—à–∏—Ç–µ¬†—Ç–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ¬†("–∫–æ—Ñ–µ —Å –º–æ–ª–æ–∫–æ–º") ‚Äì –±–æ—Ç –≤—ã–¥–∞—Å—Ç –æ—Ç—á–µ—Ç.
‚Ä¢ –û—Ç–ø—Ä–∞–≤—å—Ç–µ¬†–≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ¬†("–æ–º–ª–µ—Ç 200 –≥—Ä–∞–º–º –∏ –∞–ø–µ–ª—å—Å–∏–Ω") ‚Äì –±–æ—Ç —Ä–∞—Å—à–∏—Ñ—Ä—É–µ—Ç –∞—É–¥–∏–æ –∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç.
–ü–æ—Å–ª–µ –ø–æ–¥—Å—á–µ—Ç–∞ –ö–ë–ñ–£ –∏ –≤—ã–≤–æ–¥–∞ –æ—Ç—á–µ—Ç–∞ –º–æ–∂–Ω–æ –æ—Ç–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å –∏–ª–∏ —Å–æ—Å—Ç–∞–≤ –±–ª—é–¥–∞, –Ω–∞–∂–∞–≤ –∫–Ω–æ–ø–∫—É ¬´–ò–∑–º–µ–Ω–∏—Ç—å¬ª.  –ù–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞–ø–∏—Å–∞—Ç—å "–í–º–µ—Å—Ç–æ –º–∞—Å–ª–∞ —Ç–≤–æ—Ä–æ–∂–Ω—ã–π —Å—ã—Ä". –ë–æ—Ç –ø–µ—Ä–µ—Å—á–∏—Ç–∞–µ—Ç –ö–ë–ñ–£ –∏ –≤—ã–≤–µ–¥–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –æ—Ç—á–µ—Ç.
–ú–æ–∂–Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–∏—Ç—å –ø—Ä–∏–µ–º –ø–∏—â–∏ –∏–∑ —Å—É—Ç–æ—á–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏, –Ω–∞–∂–∞–≤ –∫–Ω–æ–ø–∫—É ¬´–£–¥–∞–ª–∏—Ç—å¬ª.
–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç–∏ –∑–∞ –¥–µ–Ω—å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –º–µ–Ω—é –±–æ—Ç–∞ –ø–æ –∫–æ–º–∞–Ω–¥–µ /stats.

<b>–ö–æ–º–∞–Ω–¥—ã –≤ –º–µ–Ω—é:</b>
- <b>/start</b>  ‚Üí –ù–∞—á–∞—Ç—å.
- <b>/help</b> ‚Üí –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏.
- <b>/stats</b> ‚Üí –õ–∏—á–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞–ª–æ—Ä–∏—è–º –∑–∞ –¥–µ–Ω—å.
- <b>/set_goal</b> ‚Üí –í—ã—Å—Ç–∞–≤–∏—Ç—å —Ü–µ–ª—å –∫–∞–ª–æ—Ä–∏–π –Ω–∞ –¥–µ–Ω—å.
- <b>/subscribe</b> ‚Äì –≤—ã–±—Ä–∞—Ç—å —Ç–∞—Ä–∏—Ñ–Ω—ã–π –ø–ª–∞–Ω.
–ï—â–µ –±–æ–ª—å—à–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏ –ª–∞–π—Ñ—Ö–∞–∫–æ–≤ –Ω–∞ –∫–∞–Ω–∞–ª–µ: @tarelka_kanal   
–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?
–ü–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º –≤–æ–ø—Ä–æ—Å–∞–º: @...
"""

SET_GOAL_TEXT : str = "–í–≤–µ–¥–∏—Ç–µ –∂–µ–ª–∞–µ–º—É—é –¥–Ω–µ–≤–Ω—É—é –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç—å"

SUBSCRIBE_TEXT : str = """
–û—Ñ–æ—Ä–º–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Å–µ—Ä–≤–∏—Å–æ–º. 

üí≥ –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ä–æ–∫ –ø–æ–¥–ø–∏—Å–∫–∏:
"""

FREE_MEAL_END_MESSAGE : str = "–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å! –û—Ñ–æ—Ä–º–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É /subscribe"

SUBSCRIPTION_NOT_ACTIVE_MESSAGE : str = "‚ùå –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–ø–ª–∞—Ç–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É. /subscribe"
